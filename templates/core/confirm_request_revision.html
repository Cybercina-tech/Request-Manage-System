{% extends "base.html" %}
{% load static %}
{# Confirm Request Revision — set NEEDS_REVISION and send Telegram with Edit & Resubmit. #}

{% block title %}Request Revision — Request {{ ad.uuid }}{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
  <h1 class="mb-0" style="background: var(--soul-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
    Request Revision
  </h1>
  <a href="{% url 'ad_detail' ad.uuid %}" class="btn btn-action"><i class="fa-solid fa-arrow-left icon" aria-hidden="true"></i> Back to Detail</a>
</div>

<div class="alert alert-info d-flex align-items-center gap-2" role="alert">
  <i class="fa-solid fa-pen-to-square icon" aria-hidden="true"></i>
  <span>The user will receive a Telegram message with an "Edit & Resubmit" button. Ad status will be set to Needs Revision.</span>
</div>

<div class="card-soul mb-4">
  <h5 class="text-muted mb-3"><i class="fa-solid fa-file-lines icon" aria-hidden="true"></i> Ad content</h5>
  <div class="ad-content-box bg-dark border border-secondary rounded p-3 mb-3" style="max-height: 240px; overflow-y: auto; white-space: pre-wrap; word-break: break-word;">{{ ad.content }}</div>
  <div class="d-flex flex-wrap gap-3 text-muted small">
    <span><strong>دسته‌بندی:</strong> {{ ad.get_category_display_fa }}</span>
    <span><strong>Submitted:</strong> {{ ad.created_at|date:"M d, Y H:i" }}</span>
  </div>
</div>

<form method="post" action="{% url 'confirm_request_revision' ad.uuid %}" id="revisionForm">
  {% csrf_token %}
  <div class="d-flex flex-wrap gap-2">
    <button type="submit" class="btn btn-soul px-4" id="confirmRevisionBtn">
      <i class="fa-solid fa-pen icon" aria-hidden="true"></i> Send revision request
    </button>
    <a href="{% url 'ad_detail' ad.uuid %}" class="btn btn-secondary px-4">Cancel</a>
  </div>
</form>

<script>
(function() {
  var form = document.getElementById('revisionForm');
  var btn = document.getElementById('confirmRevisionBtn');
  if (form && btn) {
    form.addEventListener('submit', function() {
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status"></span> Sending…';
    });
  }
})();
</script>
{% endblock %}
