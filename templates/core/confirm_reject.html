{% extends "base.html" %}
{% load static %}
{# Confirm Rejection — no modals, dedicated page. Works without JS. #}

{% block title %}Confirm Rejection — Request {{ ad.uuid }}{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
  <h1 class="mb-0" style="background: var(--soul-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
    Confirm Rejection
  </h1>
  <a href="{% url 'ad_detail' ad.uuid %}" class="btn btn-action"><i class="fa-solid fa-arrow-left icon" aria-hidden="true"></i> Back to Detail</a>
</div>

<div class="alert alert-warning d-flex align-items-center gap-2" role="alert">
  <i class="fa-solid fa-triangle-exclamation icon" aria-hidden="true"></i>
  <span>This action cannot be undone. The user will receive the rejection reason via Telegram.</span>
</div>

{% if error %}
<div class="alert alert-danger" role="alert">{{ error }}</div>
{% endif %}

<div class="card-soul mb-4">
  <h5 class="text-muted mb-3"><i class="fa-solid fa-file-lines icon" aria-hidden="true"></i> Ad content</h5>
  <div class="ad-content-box bg-dark border border-secondary rounded p-3 mb-3" style="max-height: 200px; overflow-y: auto; white-space: pre-wrap; word-break: break-word;">{{ ad.content }}</div>
  <div class="d-flex flex-wrap gap-3 text-muted small">
    <span><strong>دسته‌بندی:</strong> {{ ad.get_category_display_fa }}</span>
    <span><strong>Submitted:</strong> {{ ad.created_at|date:"M d, Y H:i" }}</span>
    {% if client %}
    <span><strong>User:</strong> {% if client.username %}@{{ client.username }}{% else %}ID {{ client.telegram_user_id }}{% endif %}</span>
    {% endif %}
  </div>
</div>

<form method="post" action="{% url 'confirm_reject' ad.uuid %}" id="rejectForm">
  {% csrf_token %}
  <div class="card-soul mb-4">
    <label class="form-label">Rejection reason <span class="text-danger">*</span></label>
    <select name="reason" class="form-select form-select-sm mb-3" required>
      <option value="">— Select reason —</option>
      {% for value, label in rejection_reasons_detail %}
      <option value="{{ value }}">{{ label }}</option>
      {% endfor %}
    </select>
    <div>
      <label class="form-label small text-muted">Optional comment (e.g. for "Other")</label>
      <textarea name="comment" class="form-control form-control-sm" rows="2" placeholder="Optional details…" maxlength="500"></textarea>
    </div>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <button type="submit" class="btn btn-hot px-4" id="confirmRejectBtn">
      <i class="fa-solid fa-times icon" aria-hidden="true"></i> Confirm Reject
    </button>
    <a href="{% url 'ad_detail' ad.uuid %}" class="btn btn-secondary px-4">
      <i class="fa-solid fa-arrow-left icon" aria-hidden="true"></i> Cancel
    </a>
  </div>
</form>

<script>
(function() {
  var form = document.getElementById('rejectForm');
  var btn = document.getElementById('confirmRejectBtn');
  if (form && btn) {
    form.addEventListener('submit', function() {
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status"></span> Rejecting…';
    });
  }
})();
</script>
{% endblock %}
